{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import express = require('express');\nimport superagent from 'superagent';\nimport bodyParser = require(\"body-parser\");\nimport {ILocation, ViaTrip} from \"./logic/ViaTrip\";\nimport { yelpApi } from '../Config/config.js';\nimport { googleApi } from '../Config/config.js';\n\nconst axios = require('axios');\nconst app = express();\nconst cors = require('cors');\n\nlet accessToken;\n\ninterface IAuthReq {\n    client_id: string;\n    client_secret: string;\n    Resource: string;\n    grant_type: string;\n}\n\ninterface IAuthRes {\n    token_type: string;\n    expires_in: string;\n    ext_expires_in: string;\n    expires_on: string;\n    not_before: string;\n    resource: string;\n    access_token: string;\n}\n\napp.use(function (req: express.Request, res: express.Response, next) {\n    // console.log('Time:', Date.now());\n    // Check req obj for any needed headers\n    const token = req.header('access_token');\n    if (token && token.length > 1) {\n        accessToken = token;\n        res.setHeader('access_token', accessToken);\n        next();\n    } else {\n        const authBody: IAuthReq = {\n            'client_id': '466c8f34-e2af-42bb-87c2-4802206168f7',\n            'client_secret': 'islsiVY6tCzezyBOHkkiMEXK7Nq07mCyj3MurrvzdYU=',\n            'Resource': '2cd2fb9a-18c2-4eb1-931b-8885c6151548',\n            'grant_type': 'client_credentials'\n        };\n        const url = 'https://login.microsoftonline.com/2a3033c2-ad76-426c-9c5a-23233cde4cde/oauth2/token';\n\n        superagent\n            .post(url)\n            .type(\"form\")\n            .send(authBody).then(authRes => {\n                const body = authRes.body as IAuthRes;\n                accessToken = body.access_token;\n                res.setHeader('access_token', accessToken);\n                next();\n            }).catch(err => {\n                console.log(err);\n            });\n    }\n\n});\n\napp.use(cors());\n\napp.use(bodyParser.json());\n\n\n//  Routes ----------------------------------------------\n\napp.post('/api/yelp', (req: express.Request, res: express.Response) => {\n    superagent\n        .get(\"https://api.yelp.com/v3/businesses/search\")\n        .set(\"Authorization\", `bearer ${yelpApi}`)\n        .query(paramReturn(req.body))\n        .set(\"Authorization\", `bearer ${yelpApi}`)\n        .then(yelpRes => {\n            res.send(JSON.parse(yelpRes.text));\n        })\n        .catch(error => console.log(error));\n});\n\napp.get('/test', (req: express.Request, res: express.Response) => {\n    const source: ILocation = {lat: '29.427839', lon: '-98.494636'};\n    const destination: ILocation = {lat: '29.424525', lon: '-98.487076'};\n    const viaTrip = new ViaTrip(source, destination, 'https://codegtfsapi.viainfo.net', accessToken);\n    viaTrip.findCloseStops(3, viaTrip.sourceLocation).then( response => {\n        res.send(response);\n    }).catch(err => {\n        res.send(err);\n    });\n\n});\n\napp.get(\"/api/all-routes/\", (req: express.Request, res: express.Response) => {\n    superagent\n        .get(\"https://codegtfsapi.viainfo.net/api/v1/routes\")\n        .set(\"Authorization\", `bearer ${accessToken}`)\n        .set(\"Accept\", \"application/json\")\n        .then(response => {\n            console.log(\"response: here\");\n            res.send(JSON.parse(response.text)[\"result\"]);\n        }).catch(err => {\n    console.log(\"error\");\n    res.send(err);\n    console.log(err)\n    });\n});\n\napp.post(\"/api/maps\",(req, res) => {\n    const currentLocation = `${req.body.currentLat},${req.body.currentLong}`;\n    superagent\n        .get(`https://maps.googleapis.com/maps/api/directions/json?origin=${currentLocation}&destination=${req.body.destination}&mode=transit&key=${googleApi}`)\n        .then(googleRes => {\n            const jsonResponse = JSON.parse(googleRes.text);\n            // if transit routes are found\n            if(jsonResponse[\"routes\"].length !== 0){\n                res.send(JSON.parse(googleRes.text)[\"routes\"][0][\"legs\"]);\n            } else {\n                res.send(JSON.parse(googleRes.text))\n            }\n    });\n\n});\n\n// catch 404 and forward to error handler\napp.use(function (req: express.Request, res: express.Response, next) {\n    let err = new Error('Not Found');\n    err['status'] = 404;\n    next(err);\n});\n\n// error handlers\n\n// development error handler\n// will print stacktrace\nif (app.get('env') === 'development') {\n    app.use((err: any, req: express.Request, res: express.Response) => {\n        res.status(err['status'] || 500);\n        res.send({\n            message: err.message,\n            error: err\n        });\n    });\n}\n\n// production error handler\n// no stacktraces leaked to user\napp.use((err: any, req: express.Request, res: express.Response) => {\n    res.status(err.status || 500);\n    res.send({\n        message: err.message,\n        error: {}\n    });\n});\n\n//helper functions\nconst paramReturn = reqParamObject => {\n    return {\n        term: reqParamObject[\"term\"] || null,\n        latitude: reqParamObject[\"lat\"] || \"29.424122\",\n        longitude: reqParamObject[\"long\"] || \"-98.493629\",\n        radius: \"8000\",\n        categories: reqParamObject[\"categories\"] || null,\n        price: reqParamObject[\"price\"] || \"1,2,3,4\"\n    }\n};\n\nconst port = process.env.port || 8081;\napp.listen(port, () => {\n    console.log(\"Skynet is active on \" + port);\n});\n"]}