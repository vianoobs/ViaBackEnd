{"version":3,"file":"utilRoutes.js","sourceRoot":"","sources":["utilRoutes.ts"],"names":[],"mappings":";;;;;AAAA,4DAAoC;AAEpC,0CAA2C;AAC3C,mCAAoC;AAEpC,IAAI,WAAW,CAAC;AAmBhB,MAAM,UAAU,GAAG,GAAG,CAAC,EAAE;IACrB,GAAG,CAAC,GAAG,CAAC,UAAU,GAAoB,EAAE,GAAqB,EAAE,IAAI;QAC/D,oCAAoC;QACpC,uCAAuC;QACvC,MAAM,KAAK,GAAG,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QACzC,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;YAC3B,WAAW,GAAG,KAAK,CAAC;YACpB,GAAG,CAAC,SAAS,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC;YAC3C,IAAI,EAAE,CAAC;SACV;aAAM;YACH,MAAM,QAAQ,GAAa;gBACvB,WAAW,EAAE,sCAAsC;gBACnD,eAAe,EAAE,8CAA8C;gBAC/D,UAAU,EAAE,sCAAsC;gBAClD,YAAY,EAAE,oBAAoB;aACrC,CAAC;YACF,MAAM,GAAG,GAAG,qFAAqF,CAAC;YAElG,oBAAU;iBACL,IAAI,CAAC,GAAG,CAAC;iBACT,IAAI,CAAC,MAAM,CAAC;iBACZ,IAAI,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;gBAC/B,MAAM,IAAI,GAAG,OAAO,CAAC,IAAgB,CAAC;gBACtC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC;gBAChC,GAAG,CAAC,SAAS,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC;gBAC3C,IAAI,EAAE,CAAC;YACX,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBACX,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACrB,CAAC,CAAC,CAAC;SACN;IAEL,CAAC,CAAC,CAAC;IAIH,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC;IAE/B,yCAAyC;IACrC,GAAG,CAAC,GAAG,CAAC,UAAU,GAAoB,EAAE,GAAqB,EAAE,IAAI;QAC/D,IAAI,GAAG,GAAG,IAAI,KAAK,CAAC,WAAW,CAAC,CAAC;QACjC,GAAG,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC;QACpB,IAAI,CAAC,GAAG,CAAC,CAAC;IACd,CAAC,CAAC,CAAC;IACH,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAC;QACtC,6DAA6D;QAC7D,2CAA2C;QAC3C,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC;QAExC,6DAA6D;QAC7D,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;QAC7B,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;YACtB,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,QAAQ,EAAE,OAAO,EAAE,YAAY,CAAC,CAAC,CAAC;QAC3E,CAAC,CAAC,CAAA;KACL;AACL,CAAC,CAAC;AAEF,kBAAe,UAAU,CAAC","sourcesContent":["import superagent from \"superagent\";\n\nimport bodyParser = require(\"body-parser\");\nimport express = require('express');\n\nlet accessToken;\n\ninterface IAuthReq {\n    client_id: string;\n    client_secret: string;\n    Resource: string;\n    grant_type: string;\n}\n\ninterface IAuthRes {\n    token_type: string;\n    expires_in: string;\n    ext_expires_in: string;\n    expires_on: string;\n    not_before: string;\n    resource: string;\n    access_token: string;\n}\n\nconst utilRoutes = app => {\n    app.use(function (req: express.Request, res: express.Response, next) {\n        // console.log('Time:', Date.now());\n        // Check req obj for any needed headers\n        const token = req.header('access_token');\n        if (token && token.length > 1) {\n            accessToken = token;\n            res.setHeader('access_token', accessToken);\n            next();\n        } else {\n            const authBody: IAuthReq = {\n                'client_id': '466c8f34-e2af-42bb-87c2-4802206168f7',\n                'client_secret': 'islsiVY6tCzezyBOHkkiMEXK7Nq07mCyj3MurrvzdYU=',\n                'Resource': '2cd2fb9a-18c2-4eb1-931b-8885c6151548',\n                'grant_type': 'client_credentials'\n            };\n            const url = 'https://login.microsoftonline.com/2a3033c2-ad76-426c-9c5a-23233cde4cde/oauth2/token';\n\n            superagent\n                .post(url)\n                .type(\"form\")\n                .send(authBody).then(authRes => {\n                const body = authRes.body as IAuthRes;\n                accessToken = body.access_token;\n                res.setHeader('access_token', accessToken);\n                next();\n            }).catch(err => {\n                console.log(err);\n            });\n        }\n\n    });\n\n\n\n    app.use(bodyParser.json());\n\n// catch 404 and forward to error handler\n    app.use(function (req: express.Request, res: express.Response, next) {\n        let err = new Error('Not Found');\n        err['status'] = 404;\n        next(err);\n    });\n    if (process.env.NODE_ENV === \"production\"){\n        // express will serve production assets ( main.js, main.css )\n        // look inside client/build to serve assets\n        app.use(express.static('client/build'));\n\n        // express will serve index.html if it doesnt recognize route\n        const path = require('path');\n        app.get(\"*\", (req, res) => {\n            res.sendFile(path.resolve(__dirname, 'client', 'build', 'index.html'));\n        })\n    }\n};\n\nexport default utilRoutes;"]}